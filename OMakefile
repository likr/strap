.PHONY: clean install

CREATE_SUBDIRS = true

CXXFLAGS += -fno-common -fPIC -Wall -std=c++11
INCLUDES += $(absname src)


DEST = /Users/likr/local


if $(equal $(SYSNAME), Darwin)
	EXT_DLL = .dylib
	export EXT_DLL


section
	FILES[] = 
		src/strap/common/core/constraint_index
		src/strap/common/core/class
		src/strap/common/core/index
		src/strap/mckp/core/problem
		src/strap/mckp/algorithm/dominate
		src/strap/mckp/algorithm/lp_dominate
		src/strap/mckp/algorithm/lp_relaxation
		src/strap/mckp/algorithm/upper_bound
		src/strap/mmkp/core/item
		src/strap/mmkp/core/problem
		src/strap/mmkp/algorithm/ecbb
		src/strap/mmkp/algorithm/entropy
		src/strap/mmkp/algorithm/entropy_core
		src/strap/mmkp/algorithm/enumerate
		src/strap/mmkp/algorithm/lp_relaxation
		src/strap/mmkp/algorithm/normalize
	LDFLAGS[] +=
		-lClp
		-lCoinUtils
	DynamicCXXLibraryInstall(install, $(DEST)/lib, libstrap, $(FILES))


section
	LDFLAGS[] += -lstrap
	CXXProgramInstall(install, $(DEST)/bin, strap, src/main)


.DEFAULT: strap

clean:
	rm -f strap libstrap.dylib

.SUBDIRS: src
